version: "3.8"

services:
  orchestrator:
    build:
      context: ..
      dockerfile: containers/orchestrator/Dockerfile
    ports:
      - "8001:8001"
    environment:
      - SERVICE_NAME=orchestrator
    networks:
      - devtools-network
    volumes:
      - orchestrator-data:/data

  feature-dev:
    build:
      context: ..
      dockerfile: containers/feature-dev/Dockerfile
    ports:
      - "8002:8002"
    environment:
      - SERVICE_NAME=feature-dev
    networks:
      - devtools-network

  code-review:
    build:
      context: ..
      dockerfile: containers/code-review/Dockerfile
    ports:
      - "8003:8003"
    environment:
      - SERVICE_NAME=code-review
    networks:
      - devtools-network

  infrastructure:
    build:
      context: ..
      dockerfile: containers/infrastructure/Dockerfile
    ports:
      - "8004:8004"
    environment:
      - SERVICE_NAME=infrastructure
    networks:
      - devtools-network

  cicd:
    build:
      context: ..
      dockerfile: containers/cicd/Dockerfile
    ports:
      - "8005:8005"
    environment:
      - SERVICE_NAME=cicd
    networks:
      - devtools-network

  documentation:
    build:
      context: ..
      dockerfile: containers/documentation/Dockerfile
    ports:
      - "8006:8006"
    environment:
      - SERVICE_NAME=documentation
    networks:
      - devtools-network

  gateway-mcp:
    build:
      context: ..
      dockerfile: containers/gateway-mcp/Dockerfile
    ports:
      - "8000:8000"
    environment:
      - SERVICE_NAME=gateway-mcp
      - NODE_ENV=production
      - LINEAR_OAUTH_DEV_TOKEN_FILE=/run/secrets/linear_oauth_token
      - LINEAR_WEBHOOK_SIGNING_SECRET_FILE=/run/secrets/linear_webhook_secret
    env_file:
      - ../configs/env/.env
    networks:
      - devtools-network
    volumes:
      - mcp-config:/app/config
    secrets:
      - linear_oauth_token
      - linear_webhook_secret

volumes:
  orchestrator-data:
  mcp-config:

secrets:
  linear_oauth_token:
    file: ../configs/env/secrets/linear_oauth_token.txt
  linear_webhook_secret:
    file: ../configs/env/secrets/linear_webhook_secret.txt

networks:
  devtools-network:
    name: devtools-network
