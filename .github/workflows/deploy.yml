name: Deploy Agents
on:
    push:
        branches: [main]

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Write secrets to files
              run: |
                  mkdir -p config/env/secrets
                  echo "${{ secrets.LINEAR_OAUTH_DEV_TOKEN }}" > config/env/secrets/linear_oauth_token.txt
                  echo "${{ secrets.LINEAR_WEBHOOK_SIGNING_SECRET }}" > config/env/secrets/linear_webhook_secret.txt
                  chmod 600 config/env/secrets/*.txt

            - name: Deploy stack
              run: |
                  docker-compose -f compose/docker-compose.yml up -d
