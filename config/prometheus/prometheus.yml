# Prometheus Scrape Configuration for Dev-Tools Agent Stack
# https://prometheus.io/docs/prometheus/latest/configuration/configuration/

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: "dev-tools"
    environment: "development"

# Scrape configurations for all services
scrape_configs:
  # ===== Agent Services =====

  - job_name: "orchestrator"
    static_configs:
      - targets: ["orchestrator:8001"]
        labels:
          service: "orchestrator"
          agent_type: "coordinator"
          role: "task-routing"

  - job_name: "feature-dev"
    static_configs:
      - targets: ["feature-dev:8002"]
        labels:
          service: "feature-dev"
          agent_type: "generator"
          role: "code-generation"

  - job_name: "code-review"
    static_configs:
      - targets: ["code-review:8003"]
        labels:
          service: "code-review"
          agent_type: "analyzer"
          role: "quality-assurance"

  - job_name: "infrastructure"
    static_configs:
      - targets: ["infrastructure:8004"]
        labels:
          service: "infrastructure"
          agent_type: "provisioner"
          role: "iac-management"

  - job_name: "cicd"
    static_configs:
      - targets: ["cicd:8005"]
        labels:
          service: "cicd"
          agent_type: "pipeline"
          role: "automation"

  - job_name: "documentation"
    static_configs:
      - targets: ["documentation:8006"]
        labels:
          service: "documentation"
          agent_type: "generator"
          role: "content-creation"

  # ===== Support Services =====

  - job_name: "gateway-mcp"
    static_configs:
      - targets: ["gateway-mcp:8000"]
        labels:
          service: "gateway"
          type: "mcp-bridge"
          role: "tool-coordination"

  - job_name: "rag-context"
    static_configs:
      - targets: ["rag-context:8007"]
        labels:
          service: "rag"
          type: "context-store"
          role: "knowledge-retrieval"
    # Longer scrape interval for RAG service
    scrape_interval: 30s

  - job_name: "state-persistence"
    static_configs:
      - targets: ["state-persistence:8008"]
        labels:
          service: "state"
          type: "persistence"
          role: "workflow-state"

  - job_name: "agent-registry"
    static_configs:
      - targets: ["agent-registry:8009"]
        labels:
          service: "agent-registry"
          type: "discovery"
          role: "agent-coordination"
    scrape_interval: 15s

  # ===== Data Stores =====
  # Note: Enable these if postgres_exporter and qdrant expose metrics

  # - job_name: 'postgres'
  #   static_configs:
  #     - targets: ['postgres:9187']  # Requires postgres_exporter
  #       labels:
  #         service: 'postgres'
  #         type: 'database'

  # - job_name: 'qdrant'
  #   static_configs:
  #     - targets: ['qdrant:6333']  # Check if Qdrant exposes Prometheus metrics
  #       labels:
  #         service: 'qdrant'
  #         type: 'vectordb'

  # ===== Prometheus Self-Monitoring =====

  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"
          type: "monitoring"
# Alerting rules (optional - for future use)
# rule_files:
#   - "alerts.yml"

# Remote write configuration (optional - for long-term storage)
# remote_write:
#   - url: "http://remote-storage:9009/api/v1/write"
