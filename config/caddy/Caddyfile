{
	# Uncomment and set your contact email to enable Let's Encrypt automatically
	# email {$CADDY_ACME_EMAIL}
}

{$CADDY_DOMAIN:-:80} {
	encode gzip zstd

	@prometheus path /prometheus*
	route @prometheus {
		uri strip_prefix /prometheus
		reverse_proxy oauth2-proxy:4180
	}

	# Pass OAuth callback traffic directly to oauth2-proxy
	handle_path /oauth2/* {
		reverse_proxy oauth2-proxy:4180
	}

	# Default route points to the MCP gateway UI/API
	handle {
		reverse_proxy gateway-mcp:8000
	}
}
